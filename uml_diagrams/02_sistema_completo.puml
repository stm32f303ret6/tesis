@startuml Sistema_Completo_RL
!theme plain
skinparam classAttributeIconSize 0
skinparam roundcorner 10
skinparam shadowing false

title Arquitectura Residual PPO (Vista Simplificada)

package "Capa de Simulación" #DDDDDD {
    class MuJoCoSimulator {
        + step()
        + reset()
    }
}

package "Capa de Control" #E7F0FF {
    class BezierGaitResidualController {
        + update()
    }

    class DiagonalGaitController {
        + update()
    }

    class IKSolver {
        + solve_leg()
    }
}

package "Capa de Aprendizaje" #F3F8FF {
    class ResidualWalkEnv {
        + reset()
        + step()
    }

    class SensorReader {
        + get_state()
    }

    class PPOAgent {
        + learn()
        + predict()
    }

    class ActorCriticPolicy {
        + forward()
    }

    class RolloutBuffer {
        + add()
        + sample()
    }
}

package "Capa de Gestión" #FCEFD6 {
    class VecEnv {
        + step_async()
        + step_wait()
    }

    class VecNormalize {
        + normalize_obs()
    }

    class CheckpointCallback {
        + on_step()
    }

    class TensorBoardLogger {
        + record()
    }
}

BezierGaitResidualController *-- DiagonalGaitController
BezierGaitResidualController ..> IKSolver : usa
ResidualWalkEnv *-- BezierGaitResidualController
ResidualWalkEnv *-- SensorReader
ResidualWalkEnv ..> MuJoCoSimulator : simula con
VecEnv *-- ResidualWalkEnv
VecNormalize o-- VecEnv
PPOAgent o-- VecNormalize
PPOAgent *-- ActorCriticPolicy
PPOAgent *-- RolloutBuffer
ActorCriticPolicy ..> RolloutBuffer : consulta datos
PPOAgent ..> CheckpointCallback
PPOAgent ..> TensorBoardLogger

@enduml
